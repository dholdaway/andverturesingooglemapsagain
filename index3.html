<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Directly accessing Street View data</title>
    <style>
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #map {
        height: 100%;
      }
    </style>
  </head>
  <body>

    <div id="map" style="width: 45%; height: 100%;float:left"></div>
    <div id="pano" style="width: 45%; height: 100%;float:left"></div>
    <script>
      /*
       * Click the map to set a new location for the Street View camera.
       */
    //    var london = {
    //        lat: 51.5082401,
    //        lng: -0.1264908
    //    };
    //    var map = new google.maps.Map(document.getElementById('map'), {
    //        zoom: 17,
    //        center: new google.maps.LatLng(51.5082401, -0.1264908),
    //        mapTypeId: google.maps.MapTypeId.ROADMAP
    //    });

       var locations = [
           ['Charing Cross Underground StationEntrance 1', 51.508239, -0.125125,98],
           ['Charing Cross Underground StationEntrance 2', 51.508574, -0.124693,99],
           ['Charing Cross Underground StationEntrance 3',51.508945, -0.124836,100],
           ['Charing Cross Underground StationEntrance 4',51.50844, -0.125866,101],
           ['Charing Cross Underground StationEntrance 5',51.509329, -0.124662,102],
           ['Charing Cross Underground StationEntrance 6',51.508685, -0.12489,103],
           ['Charing Cross Underground StationEntrance 7',51.508193, -0.125617,104],
           ['Charing Cross Underground StationEntrance 8',51.507849, -0.127158,105],
           ['Charing Cross Underground StationEntrance 10',51.507692, -0.127453,106],
           ['Charing Cross Underground StationEntrance 13',51.509024, -0.125813,107],
           ['Charing Cross Underground StationEntrance 14',51.507312, -0.128405,108],
           ['Charing Cross Underground StationEntrance 11',51.507794, -0.127089,109]
       ];

    //    var infowindow = new google.maps.InfoWindow();
       //
    //    var marker,
    //        i;
       //
    //    for (i = 0; i < locations.length; i++) {
    //        marker = new google.maps.Marker({
    //            position: new google.maps.LatLng(locations[i][1], locations[i][2]),
    //            map: map
    //        });
       //
    //        google.maps.event.addListener(marker, 'click', (function(marker, i) {
    //            return function() {
    //                infowindow.setContent(locations[i][0]);
    //                infowindow.open(map, marker);
    //            }
    //        })(marker, i));
    //    }

      //var map;

    //   var map = new google.maps.Map(document.getElementById('map'), {
    //   zoom: 17,
    //   center: new google.maps.LatLng(51.5082401,-0.1264908),
    //   mapTypeId: google.maps.MapTypeId.ROADMAP
    //   });

      var panorama;

      function initMap() {
        var london = {lat: 51.5082401, lng: -0.1264908};
        var sv = new google.maps.StreetViewService();


        // 51.5082401,-0.1264908

        panorama = new google.maps.StreetViewPanorama(document.getElementById('pano'));

        // Set up the map.
        map = new google.maps.Map(document.getElementById('map'), {
          center: london,
          zoom: 17,
          streetViewControl: false,
          mapTypeId: google.maps.MapTypeId.ROADMAP
        });

        var locations = [
            ['Charing Cross Underground StationEntrance 1', 51.508239, -0.125125,98],
            ['Charing Cross Underground StationEntrance 2', 51.508574, -0.124693,99],
            ['Charing Cross Underground StationEntrance 3',51.508945, -0.124836,100],
            ['Charing Cross Underground StationEntrance 4',51.50844, -0.125866,101],
            ['Charing Cross Underground StationEntrance 5',51.509329, -0.124662,102],
            ['Charing Cross Underground StationEntrance 6',51.508685, -0.12489,103],
            ['Charing Cross Underground StationEntrance 7',51.508193, -0.125617,104],
            ['Charing Cross Underground StationEntrance 8',51.507849, -0.127158,105],
            ['Charing Cross Underground StationEntrance 10',51.507692, -0.127453,106],
            ['Charing Cross Underground StationEntrance 13',51.509024, -0.125813,107],
            ['Charing Cross Underground StationEntrance 14',51.507312, -0.128405,108],
            ['Charing Cross Underground StationEntrance 11',51.507794, -0.127089,109]
        ];

        var infowindow = new google.maps.InfoWindow();

        var marker,
            i;

        for (i = 0; i < locations.length; i++) {
            marker = new google.maps.Marker({
                position: new google.maps.LatLng(locations[i][1], locations[i][2]),
                map: map,
                positionName: locations[i][0]
            });

            google.maps.event.addListener(marker, 'click', function() {
		infowindow.setContent(this.positionName);
                infowindow.open(map, this);
		sv.getPanorama({location: new google.maps.LatLng(this.position.lat(), this.position.lng()), radius: 50}, function(data, status) {
		   processSVData(data, status, true);
		});
            });
        }



        //var map = new google.maps.Map(document.getElementById('map'), {
        //        zoom: 17,
        //        center: new google.maps.LatLng(51.5082401, -0.1264908),
        //        mapTypeId: google.maps.MapTypeId.ROADMAP
        //    });


        // Set the initial Street View camera to the center of the map
        sv.getPanorama({location: london, radius: 50}, processSVData);

        // Look for a nearby Street View panorama when the map is clicked.
        // getPanoramaByLocation will return the nearest pano when the
        // given radius is 50 meters or less.
        map.addListener('click', function(event) {
          sv.getPanorama({location: event.latLng, radius: 50}, processSVData);
        });
      }

      function processSVData(data, status, skipMarker) {
        if (status === google.maps.StreetViewStatus.OK) {
	  if (!skipMarker) {
		  var marker = new google.maps.Marker({
		    position: data.location.latLng,
		    map: map,
		    title: data.location.description
		  });
          }

          panorama.setPano(data.location.pano);
          panorama.setPov({
            heading: 270,
            pitch: 0
          });
          panorama.setVisible(true);

	  if (!skipMarker) {
		  marker.addListener('click', function() {
		    var markerPanoID = data.location.pano;
		    // Set the Pano to use the passed panoID.
		    panorama.setPano(markerPanoID);
		    panorama.setPov({
		      heading: 270,
		      pitch: 0
		    });
		    panorama.setVisible(true);
		  });
          }
        } else {
          console.error('Street View data not found for this location.');
        }
      }
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBSZZjenQ6Qnc0m7ilMC13z_YUqE4cxCjo&callback=initMap">
    </script>
  </body>
</html>
